#!/bin/sh
#
# Pre-commit hook for agentnav
# Runs linting and formatting checks before commit
#
# Install: Run `./scripts/setup-pre-commit.sh`
# To bypass: Use `git commit --no-verify` (use sparingly)

set -e

echo "üîç Running pre-commit checks..."

# Check if bun is available
if ! command -v bun >/dev/null 2>&1; then
    echo "‚ö†Ô∏è  Warning: bun not found, skipping pre-commit checks"
    echo "   Install bun: https://bun.sh/"
    exit 0
fi

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json)$' || true)

if [ -z "$STAGED_FILES" ]; then
    echo "‚úÖ No TypeScript/JavaScript files staged, skipping checks"
    exit 0
fi

# Run ESLint on staged files (only)
echo "üìã Running ESLint on staged files..."
bun run lint -- $STAGED_FILES || {
    echo ""
    echo "‚ùå ESLint found errors. Run 'bun run lint:fix' to auto-fix some issues."
    echo "   Or use 'git commit --no-verify' to skip this check (not recommended)."
    exit 1
}

# Check Prettier formatting on staged files
echo "‚ú® Checking code formatting..."
bun run format:check || {
    echo ""
    echo "‚ùå Code formatting issues found. Run 'bun run format' to auto-fix."
    echo "   Or use 'git commit --no-verify' to skip this check (not recommended)."
    exit 1
}

echo "‚úÖ Pre-commit checks passed!"
exit 0

